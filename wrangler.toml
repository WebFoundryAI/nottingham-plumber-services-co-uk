# Cloudflare Worker Configuration for Trailing Slash Rewrite
# This worker handles internal URL rewriting for trailing slashes

name = "nottingham-plumber-services-trailing-slash-rewrite"
type = "javascript"
main = "src/worker.ts"

# Cloudflare Account Configuration
# IMPORTANT: Update these values for your account and domain
# account_id is provided via CLOUDFLARE_ACCOUNT_ID environment variable
workers_dev = false

# Environment: Production
[env.production]
# Deployment route: applies this worker to all paths on the domain
# Pattern: https://<domain>/*
routes = [
  { pattern = "nottinghamplumberservices.co.uk/*", zone_id = "" }  # Update with your Zone ID
]

# Environment: Development
[env.development]
vars = { ENVIRONMENT = "development" }
routes = [
  { pattern = "nottinghamplumberservices.co.uk/*", zone_id = "" }  # Update with your Zone ID
]

# Compatibility Date
compatibility_date = "2024-12-20"

# D1 Database binding for lead capture
# Create the database:  wrangler d1 create nottingham-plumber-leads
# Run migrations:       wrangler d1 migrations apply nottingham-plumber-leads
# Then update the database_id below with the value from the create command.
# Also add a D1 binding in Cloudflare Pages dashboard:
#   Settings > Functions > D1 database bindings > Variable name: DB
[[d1_databases]]
binding = "DB"
database_name = "nottingham-plumber-leads"
database_id = "" # TODO: Create D1 database and add ID here

# Build Configuration
[build]
command = "bun install && bun run build"
cwd = "./"
main = "dist/worker.js"

[build.upload]
format = "service-worker"
